import telebot
import random
import time
from telebot import types

TOKEN = '6584879528:AAGzgHwyBNESKAKnr1pGFyB6IgBdjvUZtX8'
bot = telebot.TeleBot(TOKEN)

player_stats = {
    '–Ω–∏–∫–Ω–µ–π–º': 'Player',
    '—É—Ä–æ–≤–µ–Ω—å': 1,
    '–æ–ø—ã—Ç': 0,
    '–º–∞–∫—Å.–æ–ø—ã—Ç': 50,
    '–∑–¥–æ—Ä–æ–≤—å–µ': 100,
    '–º–∞–∫—Å.–∑–¥–æ—Ä–æ–≤—å–µ': 100,
    '—Å–∏–ª–∞': 10,
    '–∑–∞—â–∏—Ç–∞': 1,
    '–∑–æ–ª–æ—Ç–æ': 0,
}

gold_events = [
    '–¢—ã –Ω–∞—à–µ–ª —Å—É–Ω–¥—É–∫ —Å –∑–æ–ª–æ—Ç–æ–º!',
    '–¢—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª –∑–æ–ª–æ—Ç—É—é –∂–∏–ª—É!',
    '–¢—ã –Ω–∞—à–µ–ª —É—Ç–µ—Ä—è–Ω–Ω–æ–µ –∑–æ–ª–æ—Ç–æ!',
]

monsters = [
    {'–∏–º—è': '–ì–æ–±–ª–∏–Ω', '–∑–¥–æ—Ä–æ–≤—å–µ': 30, '—Å–∏–ª–∞': 5, '–æ–ø—ã—Ç': 10},
    {'–∏–º—è': '–û—Ä–∫', '–∑–¥–æ—Ä–æ–≤—å–µ': 50, '—Å–∏–ª–∞': 8, '–æ–ø—ã—Ç': 15},
    {'–∏–º—è': '–î—Ä–∞–∫–æ–Ω', '–∑–¥–æ—Ä–æ–≤—å–µ': 100, '—Å–∏–ª–∞': 15, '–æ–ø—ã—Ç': 25},
]

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
@bot.message_handler(commands=['start'])
def start(message):
    chat_id = message.chat_id
    markup = types.ReplyKeyboardMarkup(row_width=2)
    profile = types.KeyboardButton("üë§ –ü—Ä–æ—Ñ–∏–ª—å")
    shop = types.KeyboardButton("‚öñÔ∏è –†—ã–Ω–æ–∫")
    adventure = types.KeyboardButton("üèîÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ")
    markup.add(profile, shop, adventure)
    bot.send_message(chat_id, '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é —Ç–µ–±—è, –ø—É—Ç–Ω–∏–∫!\n–≠—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤–∞—è –∏–≥—Ä–∞ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ RPG, –≤ –∫–æ—Ç–æ—Ä–æ–π —Ç—ã –º–æ–∂–µ—à—å –≤–µ—Å–µ–ª–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è\n–ñ–µ–ª–∞—é —Ç–µ–±–µ —É–¥–∞—á–∏!\n\nüí¢–ò–≥—Ä–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –∏ –∏–º–µ–µ—Ç –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–¥–æ—Ä–∞–±–æ—Ç–æ–∫, –ø—Ä–æ—Å—å–±–∞ –æ—Ç–Ω–µ—Å—Ç–∏—Å—å —Å –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º')   

@bot.message_handler(commands=['menu'])
def menu(chat_id):
    markup = types.ReplyKeyboardMarkup(row_width=2)
    profile = types.KeyboardButton("üë§ –ü—Ä–æ—Ñ–∏–ª—å")
    shop = types.KeyboardButton("‚öñÔ∏è –†—ã–Ω–æ–∫")
    adventure = types.KeyboardButton("üèîÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ")
    markup.add(profile, shop, adventure)
    bot.send_message(chat_id, '–¢—ã –≤ üèòÔ∏è –î–µ—Ä–µ–≤–Ω–µ, –≤—ã–±–µ—Ä–∏ –º–µ—Å—Ç–æ, –≤ –∫–æ—Ç–æ—Ä–æ–µ —Ö–æ—á–µ—à—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è')

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /profile
@bot.message_handler(commands=['profile'])
def profile(message):
    chat_id = message.chat.id
    # –í—ã–≤–æ–¥–∏–º –ø—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞
    profile_text = f"üë§ –ù–∏–∫–Ω–µ–π–º: {player_stats['–Ω–∏–∫–Ω–µ–π–º']}\nüí´ –£—Ä–æ–≤–µ–Ω—å: {player_stats['—É—Ä–æ–≤–µ–Ω—å']} ({player_stats['–æ–ø—ã—Ç']}/{player_stats['–º–∞–∫—Å.–æ–ø—ã—Ç']})\n‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: {player_stats['–∑–¥–æ—Ä–æ–≤—å–µ']}/{player_stats['–º–∞–∫—Å.–∑–¥–æ—Ä–æ–≤—å–µ']}\nüí™ –°–∏–ª–∞: {player_stats['—Å–∏–ª–∞']}\nüõ°Ô∏è –ó–∞—â–∏—Ç–∞: {player_stats['–∑–∞—â–∏—Ç–∞']}\nü™ô –ó–æ–ª–æ—Ç–æ: {player_stats['–∑–æ–ª–æ—Ç–æ']}\n\n–°–º–µ–Ω–∏—Ç—å –∏–º—è ‚Äì /rename (–Ω–æ–≤—ã–π –Ω–∏–∫)"
    bot.send_message(chat_id, profile_text)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /rename
@bot.message_handler(commands=['rename'])
def rename(message):
    chat_id = message.chat.id
    new_nickname = message.text.split(' ', 1)[1]
    player_stats['–Ω–∏–∫–Ω–µ–π–º'] = new_nickname
    bot.send_message(chat_id, f'–¢–≤–æ–π –Ω–æ–≤—ã–π –Ω–∏–∫–Ω–µ–π–º: {new_nickname}')

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /adventure
@bot.message_handler(commands=['adventure'])
def adventure(message):
    chat_id = message.chat.id
    bot.send_message(chat_id, '–¢—ã –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –≤ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ!/n–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã —Å–æ–≤—Å–µ–º —Å–∫–æ—Ä–æ!)')
    result = random.choice(['–∑–æ–ª–æ—Ç–æ', '–º–æ–Ω—Å—Ç—Ä'])
    if result == '–∑–æ–ª–æ—Ç–æ':
        time.sleep(5)
        gold_amount = random.randint(1, 3)
        player_stats['–∑–æ–ª–æ—Ç–æ'] += gold_amount
        event_text = random.choice(gold_events)
        bot.send_message(chat_id, f'{event_text} –¢—ã –Ω–∞—à–µ–ª ü™ô {gold_amount} –∑–æ–ª–æ—Ç–∞!')
        continue_or_run(chat_id)
    elif result == '–º–æ–Ω—Å—Ç—Ä':
        time.sleep(5)
        bot.send_message(chat_id, '–¢—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª –º–æ–Ω—Å—Ç—Ä–∞!')
        fight_or_run(chat_id)

def escape_or_attack(chat_id):
    # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    escape_button = types.InlineKeyboardButton("–°–±–µ–∂–∞—Ç—å")
    attack_button = types.InlineKeyboardButton("–ê—Ç–∞–∫–æ–≤–∞—Ç—å")
    markup.add(escape_button, attack_button)
    bot.send_message(chat_id, "–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=markup)

def return_or_continue(chat_id):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    return_button = types.InlineKeyboardButton("–í–µ—Ä–Ω—É—Ç—å—Å—è")
    continue_button = types.InlineKeyboardButton("–ò–¥—Ç–∏ –¥–∞–ª—å—à–µ")
    markup.add(return_button, continue_button)
    bot.send_message(chat_id, "–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=markup)

def take_damage(chat_id, damage):
    player_stats['–∑–¥–æ—Ä–æ–≤—å–µ'] -= damage
    bot.send_message(chat_id, f"–¢—ã –ø–æ–ª—É—á–∏–ª {damage} —É—Ä–æ–Ω–∞! –¢–≤–æ–µ —Ç–µ–∫—É—â–µ–µ –∑–¥–æ—Ä–æ–≤—å–µ: {player_stats['–∑–¥–æ—Ä–æ–≤—å–µ']}")
    if player_stats['–∑–¥–æ—Ä–æ–≤—å–µ'] <= 0:
        bot.send_message(chat_id, "–¢—ã –ø–æ–≥–∏–±...")
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–º–µ—Ä—Ç–∏ –∏–≥—Ä–æ–∫–∞

def attack_monster(chat_id):
    monster = random.choice(monsters)
    monster_health = monster['–∑–¥–æ—Ä–æ–≤—å–µ']
    monster_damage = monster['—Å–∏–ª–∞']
    player_damage = player_stats['—Å–∏–ª–∞']
    player_defense = player_stats['–∑–∞—â–∏—Ç–∞']
    player_experience = player_stats['–æ–ø—ã—Ç']

    battle_result_message = bot.send_message(chat_id, "–ë–∏—Ç–≤–∞ –Ω–∞—á–∞–ª–∞—Å—å!")
    time.sleep(2)
    result_message = "–ë–∏—Ç–≤–∞ –Ω–∞—á–∞–ª–∞—Å—å!"

    while monster_health > 0 and player_stats['–∑–¥–æ—Ä–æ–≤—å–µ'] > 0:
        monster_damage_dealt = max(monster_damage - player_defense, 0)
        player_damage_dealt = max(player_damage - monster_damage, 0)
        
        if monster_damage_dealt > 0:
            player_stats['–∑–¥–æ—Ä–æ–≤—å–µ'] -= monster_damage_dealt
            result_message += f"\n–ú–æ–Ω—Å—Ç—Ä –∞—Ç–∞–∫–æ–≤–∞–ª —Ç–µ–±—è! –¢—ã –ø–æ–ª—É—á–∏–ª {monster_damage_dealt} —É—Ä–æ–Ω–∞. –¢–≤–æ–µ —Ç–µ–∫—É—â–µ–µ –∑–¥–æ—Ä–æ–≤—å–µ: {player_stats['–∑–¥–æ—Ä–æ–≤—å–µ']}"
        
        if player_stats['–∑–¥–æ—Ä–æ–≤—å–µ'] <= 0:
            bot.send_message(chat_id, "–¢—ã –ø–æ–≥–∏–± –≤ –±–æ—é!")
            # Additional logic for handling player death
            return
        
        if player_damage_dealt > 0:
            monster_health -= player_damage_dealt
            result_message += f"\n–¢—ã –∞—Ç–∞–∫–æ–≤–∞–ª –º–æ–Ω—Å—Ç—Ä–∞! –ú–æ–Ω—Å—Ç—Ä—É –æ—Å—Ç–∞–ª–æ—Å—å {monster_health} –∑–¥–æ—Ä–æ–≤—å—è."
        
        bot.edit_message_text(chat_id, battle_result_message.message_id, result_message)
        time.sleep(2)
   
    if monster_health <= 0:
        gold_amount = random.randint(5, 10)
        exp_amount += monster['–æ–ø—ã—Ç']
        player_stats['–∑–æ–ª–æ—Ç–æ'] += gold_amount
        player_stats['–æ–ø—ã—Ç'] += exp_amount
        bot.send_message(chat_id, f"–¢—ã –ø–æ–±–µ–¥–∏–ª –º–æ–Ω—Å—Ç—Ä–∞ {monster['–∏–º—è']}!\n–¢—ã –ø–æ–ª—É—á–∏–ª ü™ô {gold_amount} –∑–æ–ª–æ—Ç–∞ –∞ —Ç–∞–∫ –∂–µ ‚ò£Ô∏è {exp_amount} –æ–ø—ã—Ç–∞!")

        
        level_up_experience = player_stats['–º–∞–∫—Å.–æ–ø—ã—Ç'] * player_stats['—É—Ä–æ–≤–µ–Ω—å']
        if player_experience >= player_stats['–æ–ø—ã—Ç']:
            player_stats['—É—Ä–æ–≤–µ–Ω—å'] += 1
            player_stats['–∑–¥–æ—Ä–æ–≤—å–µ'] += 20
            player_stats['—Å–∏–ª–∞'] += 5
            player_stats['–∑–∞—â–∏—Ç–∞'] += 1
            bot.send_message(chat_id, f"–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –¢—ã –¥–æ—Å—Ç–∏–≥ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è: {player_stats['—É—Ä–æ–≤–µ–Ω—å']}!")

    # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
    markup = types.InlineKeyboardMarkup(row_width=2)
    continue_button = types.InlineKeyboardButton("–ò–¥—Ç–∏ –¥–∞–ª—å—à–µ", callback_data="continue")
    return_home_button = types.InlineKeyboardButton("–í–µ—Ä–Ω—É—Ç—å—Å—è –¥–æ–º–æ–π", callback_data="return_home")
    markup.add(continue_button, return_home_button)
    bot.send_message(chat_id, "–í—ã–±–µ—Ä–∏ –¥–∞–ª—å–Ω–µ–π—à–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=markup)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–æ–∫
@bot.message_handler(func=lambda message: True)
def handle_button_click(message):
    if message.text == "üë§ –ü—Ä–æ—Ñ–∏–ª—å":
        profile(chat_id)
    if message.text == "‚öñÔ∏è –†—ã–Ω–æ–∫":
        bot.send_message(chat_id, "–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ")
    if message.text == "üèîÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ":
        adventure(chat_id)
    if message.text == "–°–±–µ–∂–∞—Ç—å":
        escape_chance = random.randint(1, 10)
        if escape_chance <= 4:
            bot.send_message(chat_id, "–¢—ã —Å–º–æ–≥ —Å–±–µ–∂–∞—Ç—å!")
        else:
            damage = random.randint(20, 50)
            take_damage(chat_id, damage)
    if message.text == "–ê—Ç–∞–∫–æ–≤–∞—Ç—å":
        attack_monster(chat_id)
    if message.text == "–ò–¥—Ç–∏ –¥–∞–ª—å—à–µ":
        adventure(chat_id)
    if message.text == "–í–µ—Ä–Ω—É—Ç—å—Å—è":
        bot.send_message(chat_id, "–¢—ã –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –¥–æ–º–æ–π, –ø—É—Ç—å –∑–∞–π–º–µ—Ç –∫–∞–∫–æ–µ-—Ç–æ –≤—Ä–µ–º—è...")
        menu(chat_id)

bot.polling()
