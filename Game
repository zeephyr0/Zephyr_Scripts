import telebot
import random
import time
from telebot import types

TOKEN = '6584879528:AAGzgHwyBNESKAKnr1pGFyB6IgBdjvUZtX8'
bot = telebot.TeleBot(TOKEN)

player_stats = {
    '–Ω–∏–∫–Ω–µ–π–º': 'Player',
    '—É—Ä–æ–≤–µ–Ω—å': 1,
    '–∑–¥–æ—Ä–æ–≤—å–µ': 100,
    '—Å–∏–ª–∞': 10,
    '–∑–∞—â–∏—Ç–∞': 1,
    '–∑–æ–ª–æ—Ç–æ': 0,
    '–æ–ø—ã—Ç': 0,
}

gold_events = [
    '–¢—ã –Ω–∞—à–µ–ª —Å—É–Ω–¥—É–∫ —Å –∑–æ–ª–æ—Ç–æ–º!',
    '–¢—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª –∑–æ–ª–æ—Ç—É—é –∂–∏–ª—É!',
    '–¢—ã –Ω–∞—à–µ–ª —É—Ç–µ—Ä—è–Ω–Ω–æ–µ –∑–æ–ª–æ—Ç–æ!',
]

monsters = [
    {'–∏–º—è': '–ì–æ–±–ª–∏–Ω', '–∑–¥–æ—Ä–æ–≤—å–µ': 30, '—Å–∏–ª–∞': 5, '–æ–ø—ã—Ç': 10},
    {'–∏–º—è': '–û—Ä–∫', '–∑–¥–æ—Ä–æ–≤—å–µ': 50, '—Å–∏–ª–∞': 8, '–æ–ø—ã—Ç': 15},
    {'–∏–º—è': '–î—Ä–∞–∫–æ–Ω', '–∑–¥–æ—Ä–æ–≤—å–µ': 100, '—Å–∏–ª–∞': 15, '–æ–ø—ã—Ç': 25},
]

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
@bot.message_handler(commands=['start'])
def start(message):
    chat_id = message.chat.id
    bot.send_message(chat_id, '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é —Ç–µ–±—è, –ø—É—Ç–Ω–∏–∫!\n–≠—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤–∞—è –∏–≥—Ä–∞ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ RPG, –≤ –∫–æ—Ç–æ—Ä–æ–π —Ç—ã –º–æ–∂–µ—à—å –≤–µ—Å–µ–ª–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è\n–ñ–µ–ª–∞—é —Ç–µ–±–µ —É–¥–∞—á–∏!\n\nüí¢–ò–≥—Ä–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –∏ –∏–º–µ–µ—Ç –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–¥–æ—Ä–∞–±–æ—Ç–æ–∫, –ø—Ä–æ—Å—å–±–∞ –æ—Ç–Ω–µ—Å—Ç–∏—Å—å —Å –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º')

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /rename
@bot.message_handler(commands=['rename'])
def rename(message):
    chat_id = message.chat.id
    new_nickname = message.text.split(' ', 1)[1]
    player_stats['–Ω–∏–∫–Ω–µ–π–º'] = new_nickname
    bot.send_message(chat_id, f'–¢–≤–æ–π –Ω–æ–≤—ã–π –Ω–∏–∫–Ω–µ–π–º: {new_nickname}')

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /adventure
@bot.message_handler(commands=['adventure'])
def adventure(message):
    chat_id = message.chat.id
    bot.send_message(chat_id, '–¢—ã –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –≤ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ!')
    result = random.choice(['–∑–æ–ª–æ—Ç–æ', '–º–æ–Ω—Å—Ç—Ä'])
    if result == '–∑–æ–ª–æ—Ç–æ':
        gold_amount = random.randint(1, 10)
        player_stats['–∑–æ–ª–æ—Ç–æ'] += gold_amount
        event_text = random.choice(gold_events)
        bot.send_message(chat_id, f'{event_text} –¢—ã –Ω–∞—à–µ–ª {gold_amount} –∑–æ–ª–æ—Ç–∞!')
    elif result == '–º–æ–Ω—Å—Ç—Ä':
        bot.send_message(chat_id, '–¢—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª –º–æ–Ω—Å—Ç—Ä–∞!')
        fight_or_run(chat_id)

def fight_or_run(chat_id):
    # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è
    markup = types.InlineKeyboardMarkup(row_width=2)
    escape_button = types.InlineKeyboardButton("–°–±–µ–∂–∞—Ç—å", callback_data="escape")
    attack_button = types.InlineKeyboardButton("–ê—Ç–∞–∫–æ–≤–∞—Ç—å", callback_data="attack")
    markup.add(escape_button, attack_button)
    bot.send_message(chat_id, "–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=markup)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /profile
@bot.message_handler(commands=['profile'])
def profile(message):
    chat_id = message.chat.id
    # –í—ã–≤–æ–¥–∏–º –ø—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞
    profile_text = f"–ù–∏–∫–Ω–µ–π–º: {player_stats['–Ω–∏–∫–Ω–µ–π–º']}\n–£—Ä–æ–≤–µ–Ω—å: {player_stats['—É—Ä–æ–≤–µ–Ω—å']}\n–ó–¥–æ—Ä–æ–≤—å–µ: {player_stats['–∑–¥–æ—Ä–æ–≤—å–µ']}\n–°–∏–ª–∞: {player_stats['—Å–∏–ª–∞']}\n–ó–∞—â–∏—Ç–∞: {player_stats['–∑–∞—â–∏—Ç–∞']}\n–ó–æ–ª–æ—Ç–æ: {player_stats['–∑–æ–ª–æ—Ç–æ']}\n–û–ø—ã—Ç: {player_stats['–æ–ø—ã—Ç']}"
    bot.send_message(chat_id, profile_text)

def take_damage(chat_id, damage):
    player_stats['–∑–¥–æ—Ä–æ–≤—å–µ'] -= damage
    bot.send_message(chat_id, f"–¢—ã –ø–æ–ª—É—á–∏–ª {damage} —É—Ä–æ–Ω–∞! –¢–≤–æ–µ —Ç–µ–∫—É—â–µ–µ –∑–¥–æ—Ä–æ–≤—å–µ: {player_stats['–∑–¥–æ—Ä–æ–≤—å–µ']}")
    if player_stats['–∑–¥–æ—Ä–æ–≤—å–µ'] <= 0:
        bot.send_message(chat_id, "–¢—ã –ø–æ–≥–∏–± –≤ –±–æ—é!")
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–º–µ—Ä—Ç–∏ –∏–≥—Ä–æ–∫–∞

def attack_monster(chat_id):
    monster = random.choice(monsters)
    monster_health = monster['–∑–¥–æ—Ä–æ–≤—å–µ']
    monster_damage = monster['—Å–∏–ª–∞']
    player_damage = player_stats['—Å–∏–ª–∞']
    player_defense = player_stats['–∑–∞—â–∏—Ç–∞']
    player_experience = player_stats['–æ–ø—ã—Ç']
    
    while monster_health > 0 and player_stats['–∑–¥–æ—Ä–æ–≤—å–µ'] > 0:
        monster_damage_dealt = max(monster_damage - player_defense, 0)
        player_damage_dealt = max(player_damage - monster_damage, 0)
        
        if monster_damage_dealt > 0:
            player_stats['–∑–¥–æ—Ä–æ–≤—å–µ'] -= monster_damage_dealt
            bot.send_message(chat_id, f"–ú–æ–Ω—Å—Ç—Ä –∞—Ç–∞–∫–æ–≤–∞–ª —Ç–µ–±—è! –¢—ã –ø–æ–ª—É—á–∏–ª {monster_damage_dealt} —É—Ä–æ–Ω–∞. –¢–≤–æ–µ —Ç–µ–∫—É—â–µ–µ –∑–¥–æ—Ä–æ–≤—å–µ: {player_stats['–∑–¥–æ—Ä–æ–≤—å–µ']}")
        
        if player_stats['–∑–¥–æ—Ä–æ–≤—å–µ'] <= 0:
            bot.send_message(chat_id, "–¢—ã –ø–æ–≥–∏–± –≤ –±–æ—é!")
            # Additional logic for handling player death
            return
        
        if player_damage_dealt > 0:
            monster_health -= player_damage_dealt
            bot.send_message(chat_id, f"–¢—ã –∞—Ç–∞–∫–æ–≤–∞–ª –º–æ–Ω—Å—Ç—Ä–∞! –ú–æ–Ω—Å—Ç—Ä—É –æ—Å—Ç–∞–ª–æ—Å—å {monster_health} –∑–¥–æ—Ä–æ–≤—å—è.")

    if monster_health <= 0:
        bot.send_message(chat_id, f"–¢—ã –ø–æ–±–µ–¥–∏–ª –º–æ–Ω—Å—Ç—Ä–∞ {monster['–∏–º—è']}!")
        gold_amount = random.randint(10, 20)
        player_stats['–∑–æ–ª–æ—Ç–æ'] += gold_amount
        bot.send_message(chat_id, f"–¢—ã –ø–æ–ª—É—á–∏–ª {gold_amount} –∑–æ–ª–æ—Ç–∞!")
        player_experience += monster['–æ–ø—ã—Ç']
        player_stats['–æ–ø—ã—Ç'] = player_experience
        
        level_up_experience = 50 * player_stats['—É—Ä–æ–≤–µ–Ω—å']
        if player_experience >= level_up_experience:
            player_stats['—É—Ä–æ–≤–µ–Ω—å'] += 1
            player_stats['–∑–¥–æ—Ä–æ–≤—å–µ'] += 20
            player_stats['—Å–∏–ª–∞'] += 5
            player_stats['–∑–∞—â–∏—Ç–∞'] += 1
            bot.send_message(chat_id, f"–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –¢—ã –¥–æ—Å—Ç–∏–≥ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è: {player_stats['—É—Ä–æ–≤–µ–Ω—å']}!")

    # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
    markup = types.InlineKeyboardMarkup(row_width=2)
    continue_button = types.InlineKeyboardButton("–ò–¥—Ç–∏ –¥–∞–ª—å—à–µ", callback_data="continue")
    return_home_button = types.InlineKeyboardButton("–í–µ—Ä–Ω—É—Ç—å—Å—è –¥–æ–º–æ–π", callback_data="return_home")
    markup.add(continue_button, return_home_button)
    bot.send_message(chat_id, "–í—ã–±–µ—Ä–∏ –¥–∞–ª—å–Ω–µ–π—à–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=markup)

@bot.callback_query_handler(func=lambda call: True)
def callback_handler(call):
    chat_id = call.message.chat.id
    if call.data == "escape":
        escape_chance = random.randint(1, 10)
        if escape_chance <= 4:
            bot.send_message(chat_id, "–¢—ã —Å–º–æ–≥ —Å–±–µ–∂–∞—Ç—å!")
        else:
            damage = random.randint(20, 50)
            take_damage(chat_id, damage)
    elif call.data == "attack":
        attack_monster(chat_id)
    elif call.data == "continue":
        bot.send_message(chat_id, "–¢—ã –∏–¥–µ—à—å –¥–∞–ª—å—à–µ!")
        adventure(chat_id)
    elif call.data == "return_home":
        bot.send_message(chat_id, "–¢—ã –≤–µ—Ä–Ω—É–ª—Å—è –¥–æ–º–æ–π!")
        player_stats['–∑–¥–æ—Ä–æ–≤—å–µ'] = 100
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–æ–º–æ–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è

def adventure_timer():
    # –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ 2 –º–∏–Ω—É—Ç—ã (120 —Å–µ–∫—É–Ω–¥)
    time.sleep(120)
    # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è
    # –ù–∞–ø—Ä–∏–º–µ—Ä, —É–≤–µ–¥–æ–º–ª—è—Ç—å –∏–≥—Ä–æ–∫–∞ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏ –¥–∞–≤–∞—Ç—å –µ–º—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ —Å–Ω–æ–≤–∞
    bot.send_message(chat_id, '–¢–≤–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å!')
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è
bot.polling()
