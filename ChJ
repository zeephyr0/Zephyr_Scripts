import time
from telethon.sync import TelegramClient, events

# Здесь нужно указать данные для каждого клиента
api_id1 = 'API_ID_1'
api_hash1 = 'API_HASH_1'
api_id2 = 'API_ID_2'
api_hash2 = 'API_HASH_2'
api_id3 = 'API_ID_3'
api_hash3 = 'API_HASH_3'

# Создаем список с данными для каждого клиента
clients = [
    {'api_id': api_id1, 'api_hash': api_hash1},
    {'api_id': api_id2, 'api_hash': api_hash2},
    {'api_id': api_id3, 'api_hash': api_hash3}
]

# Создаем список для хранения ссылок на каналы
channel_links = []

# Функция для подписки на каналы
def join_channel(client, link):
    try:
        client(InviteToChannelRequest(link))
        print(f'Клиент {client.session.user_id} подписался на канал {link}')
    except Exception as e:
        print(f'Ошибка при подписке клиента {client.session.user_id} на канал {link}: {e}')

# Функция для подписки на группу
def join_chat(client):
    try:
        client(JoinChannelRequest('@281'))
        print(f'Клиент {client.session.user_id} присоединился к группе @281')
    except Exception as e:
        print(f'Ошибка при присоединении клиента {client.session.user_id} к группе @281: {e}')

# Функция-обработчик новых сообщений в группе
def handle_group_message(event):
    message_text = event.message.message.lower()
    if message_text.startswith('join'):
        link = message_text.split(' ')[1]
        channel_links.append(link)
        print(f'Добавлена ссылка на канал: {link}')
        for client in clients:
            join_channel(client, link)
            time.sleep(3)
    elif message_text.startswith('join_chat'):
        for client in clients:
            join_chat(client)
            time.sleep(7)

# Запускаем клиентов и подписываемся на события новых сообщений в группе
for client_data in clients:
    with TelegramClient('session_name', client_data['api_id'], client_data['api_hash']) as client:
        client.add_event_handler(handle_group_message, events.NewMessage(chats='group_username'))
        client.run_until_disconnected()
